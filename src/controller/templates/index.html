<!DOCTYPE html>
<html>
<head>
    <title>Habitat Controller</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
</head>
<body>
    <h1>Habitat Controller</h1>
    
    <div id="module-list">
        <h2>Discovered Modules</h2>
        <div id="modules"></div>
    </div>

    <script>
        // WebSocket connection
        const socket = io(window.location.origin, {
            transports: ['websocket'],
            upgrade: false
        });
        
        // WebSocket event handlers
        socket.on('connect', function() {
            console.log('WebSocket connection established');
        });
        
        socket.on('module_update', function(data) {
            console.log('Received module update:', data);
            updateModuleList(data.modules);
        });
        
        socket.on('ptp_status', function(data) {
            console.log('Received PTP update:', data);
            updatePTPChart(data);
        });
        
        socket.on('disconnect', function() {
            console.log('WebSocket connection closed');
        });
        
        socket.on('error', function(error) {
            console.error('WebSocket error:', error);
        });

        function updateModuleList(modules) {
            const moduleList = document.getElementById('modules');
            moduleList.innerHTML = '';
            
            if (modules.length === 0) {
                moduleList.innerHTML = '<p>No modules found</p>';
                return;
            }
            
            modules.forEach(module => {
                const moduleDiv = document.createElement('div');
                moduleDiv.className = 'module-item';
                moduleDiv.innerHTML = `
                    <p>ID: ${module.id}</p>
                    <p>Type: ${module.type}</p>
                    <p>IP: ${module.ip}</p>
                `;
                moduleList.appendChild(moduleDiv);
            });
        }

        function updatePTPChart(data) {
            // TODO: Implement PTP chart update
            console.log('PTP data:', data);
        }
    </script>
</body>
</html> 